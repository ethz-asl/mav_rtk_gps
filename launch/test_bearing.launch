<launch>

  <!-- Before launching this file remember to,
       1. Set ROS_MASTER_URI with ROS uri of the MAV you want to calibrate; 
       2. Set ROS_IP with IP of your machine.
       OR 
       1. roscd mav_startup/scripts/
       2. source configure_ros_network.sh.sh <IP_ROS_MASTER>
       Script meant to be used mainly with Hummingbird MAVs. -->
  <arg name="mav_name" default="hawk"/>
  <arg name="magnetometer_topic" default="/$(arg mav_name)/fcu/mag"/>

	<!-- Convert magnetic field to bearing angle, angle == 0 if X axis of sensor points North -->
  <node pkg="mbzirc_init_rovio" type="bearing_from_mag.py" name="bearing_from_mag" output="screen">
  	<!-- Calibration data -->
    <rosparam file="$(find mav_startup)/parameters/mavs/$(arg mav_name)/magnetometer_calibration.yaml"/>

    <!-- Debugging variables -->
    <param name="bearing_constant_offset_deg" value="0.0" /> 
    <param name="verbose" value="True" /> 

    <remap from="magnetic_field" to="$(arg magnetometer_topic)"/>
  </node>

  <node name="rqt_plot" pkg="rqt_plot" type="rqt_plot"
      args="bearing_from_mag/bearing_raw_deg bearing_from_mag/bearing_avg_deg"
      respawn="false" output="screen" />

</launch>